#!/usr/bin/env sh

# ██╗   ██╗       █████╗       ██████╗        █████╗       ██╗
# ╚██╗ ██╔╝      ██╔══██╗      ██╔══██╗      ██╔══██╗      ██║
#  ╚████╔╝       ███████║      ██████╔╝      ███████║      ██║
#   ╚██╔╝        ██╔══██║      ██╔══██╗      ██╔══██║      ██║
#    ██║         ██║  ██║      ██████╔╝      ██║  ██║      ██║
#    ╚═╝         ╚═╝  ╚═╝      ╚═════╝       ╚═╝  ╚═╝      ╚═╝

# Unload the macOS WindowManager process
launchctl unload -F /System/Library/LaunchAgents/com.apple.WindowManager.plist >/dev/null 2>&1 &

sudo yabai --load-sa
yabai -m signal --add event=dock_did_restart action="sudo yabai --load-sa"

yabai -m signal --add event=mission_control_exit action='echo "refresh" | nc -U /tmp/yabai-indicator.socket'
yabai -m signal --add event=display_added action='echo "refresh" | nc -U /tmp/yabai-indicator.socket'
yabai -m signal --add event=display_removed action='echo "refresh" | nc -U /tmp/yabai-indicator.socket'
yabai -m signal --add event=window_created action='echo "refresh windows" | nc -U /tmp/yabai-indicator.socket'
yabai -m signal --add event=window_destroyed action='echo "refresh windows" | nc -U /tmp/yabai-indicator.socket'
yabai -m signal --add event=window_focused action='echo "refresh windows" | nc -U /tmp/yabai-indicator.socket'
yabai -m signal --add event=window_moved action='echo "refresh windows" | nc -U /tmp/yabai-indicator.socket'
yabai -m signal --add event=window_resized action='echo "refresh windows" | nc -U /tmp/yabai-indicator.socket'
yabai -m signal --add event=window_minimized action='echo "refresh windows" | nc -U /tmp/yabai-indicator.socket'
yabai -m signal --add event=window_deminimized action='echo "refresh windows" | nc -U /tmp/yabai-indicator.socket'

gap=12
grid=24:24:2:2:20:20

# global settings
# yabai -m config external_bar all:40:0
yabai -m config external_bar all:0:0
yabai -m config mouse_modifier ctrl
yabai -m config window_topmost off
yabai -m config window_shadow float

yabai -m config window_placement second_child
yabai -m config window_origin_display focused

# general space settings
yabai -m config layout bsp
yabai -m config top_padding $gap
yabai -m config bottom_padding $gap
yabai -m config left_padding $gap
yabai -m config right_padding $gap
yabai -m config window_gap $gap

yabai -m config window_border on
yabai -m config window_border_hidpi off
yabai -m config window_border_blur off
yabai -m config window_border_radius 11
yabai -m config window_border_width 2
yabai -m config active_window_border_color 0xffe1e3e4
yabai -m config normal_window_border_color 0xff494d64
yabai -m config insert_feedback_color 0xff9dd274

# yabai -m config --space Code layout stack
yabai -m config --space 3 layout stack
yabai -m config --space 2 layout stack
# yabai -m config --space 4 layout float
# yabai -m config --space other layout float

# rule
yabai -m rule --add app="^Code$" space=2
yabai -m rule --add app="^webstorm$" layer=normal space=2

yabai -m rule --add app="^微信开发者工具$" space=3

yabai -m rule --add app="^(企业微信|网易云音乐|喜马拉雅|QQ|QQ音乐|微信|Listen1)$" space=4 layer=normal manage=off grid=$grid

yabai -m rule --add app="^访达$" manage=off grid=$grid border=off
yabai -m rule --add app="^系统偏好设置$" manage=off layer=normal sticky=on grid=$grid
yabai -m rule --add app="^mpv$" manage=off layer=normal sticky=on grid=3:1:2:0:3:1
yabai -m rule --add app="^Rime$" manage=off

yabai -m rule --add app="^预览$" layer=normal manage=off grid=$grid

yabai -m rule --add app="^WebStorm$" manage=off
yabai -m rule --add app="^WebStorm$" title="( – )" manage=onj
yabai -m rule --add app="^Snipaste$" manage=off

echo "yabai configuration loaded.."
